var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function a(e){try{h(n.next(e))}catch(t){o(t)}}function s(e){try{h(n["throw"](e))}catch(t){o(t)}}function h(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(a,s)}h((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,o&&(a=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){h.label=i[1];break}if(6===i[0]&&h.label<a[1]){h.label=a[1],a=i;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(i);break}a[2]&&h.ops.pop(),h.trys.pop();continue}i=t.call(e,h)}catch(n){i=[6,n],o=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,a,s,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},WindowType=function(){function e(){}return e.ALERT_WIN="ALERT_WIN",e}();__reflect(WindowType.prototype,"WindowType");var FocusRole=function(e){function t(){var i=e.call(this)||this;i.__isFocus=!1,i.id=0,i.isDead=!1,i._way=-1,t._addId++,i.id=t._addId;var n=new egret.Shape;return i.addChild(n),n.graphics.beginFill(255),n.graphics.drawCircle(0,0,10),i.mc=new egret.MovieClip,i.addChild(i.mc),i.mc.x=-430,i.mc.y=-400,i.setWay(0),i}return __extends(t,e),t.prototype.setDead=function(e){if(this.isDead=e,e){if(Globals.i().killNum++,WinsManager.getIns().showFloatText(Globals.i().killNum+"击"),null==this.filters){var t=new Array;t.push(new egret.GlowFilter(16776960,1,10,10,100)),this.filters=t}}else this.filters=null},t.prototype.setWay=function(e){if(e!=this._way){this._way=e,0>e?(e=Math.abs(e),this.scaleX=-1):this.scaleX=1;var t;this.mcData||RES.getResByUrl("resource/assets/hero/Person/1003_walk_2840d952.json",function(e){this.mcData=JSON.parse(e)},this,RES.ResourceItem.TYPE_TEXT);var i,n=this.mc;RES.getResByUrl("resource/assets/hero/Person/1003_walk_4a5945e3.png",function(r){i=r,t=new egret.MovieClipDataFactory(this.mcData,i),n.movieClipData=t.generateMovieClipData("0_3_walk_"+e),n.play(-1)},this,RES.ResourceItem.TYPE_IMAGE)}},t.prototype.synWay=function(e,t){var i=Math.atan2(e-this.x,t-this.y);i=180*i/Math.PI+360;var n=(8-Math.round(i/45))%8;console.log(n),this.setWay(n)},t.prototype.renderUpdate=function(e){},t.prototype.addToWorld=function(){RenderManager.getIns().registRender(this)},t.prototype.setFocus=function(e){return this.__isFocus=e,this},t.prototype.setAreaKey=function(e){this._ak=e},t.prototype.getAreaKey=function(){return this._ak},t.prototype.removed=function(){},t.prototype.added=function(){},t.prototype.tryOption=function(e,t){return 0},t.prototype.hitTestArea=function(e,t){return!1},t.prototype.getOptType=function(){return this.type},t._addId=0,t}(egret.DisplayObjectContainer);__reflect(FocusRole.prototype,"FocusRole",["IFocus","IRender","IRole"]);var GameWindow=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.layerType="",t.__inited=!1,t.__align="NONE",t.__offsetX=0,t.__offsetY=0,t.pop=!1,t}return __extends(t,e),t.prototype.partAdded=function(t,i){i.name=t,e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.visible=!0,this.resize()},t.prototype.reOpen=function(){this.visible=!0},t.prototype.update=function(e,t){},t.prototype.beforeClose=function(){return!0},t.prototype.resize=function(){switch(this.__align){case AlignType.TOP_LEFT:this.x=this.__offsetX,this.y=this.__offsetY;break;case AlignType.TOP_CENTER:this.x=(WinsManager.stageWidth-this.width*this.scaleX)/2+this.__offsetX,this.y=this.__offsetY;break;case AlignType.TOP_RIGHT:this.x=WinsManager.stageWidth-this.width*this.scaleX+this.__offsetX,this.y=this.__offsetY;break;case AlignType.CENTER:this.x=(WinsManager.stageWidth-this.width*this.scaleX)/2+this.__offsetX,this.y=(WinsManager.stageHeight-this.height*this.scaleY)/2+this.__offsetY;break;case AlignType.BOTTOM_LEFT:this.x=this.__offsetX,this.y=WinsManager.stageHeight-this.height*this.scaleY+this.__offsetY;break;case AlignType.BOTTOM_CENTER:this.x=this.x=(WinsManager.stageWidth-this.width*this.scaleX)/2+this.__offsetX,this.y=WinsManager.stageHeight-this.height*this.scaleY+this.__offsetY;break;case AlignType.BOTTOM_RIGHT:this.x=WinsManager.stageWidth-this.width*this.scaleX+this.__offsetX,this.y=WinsManager.stageHeight-this.height*this.scaleY+this.__offsetY}},t.prototype.align=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.__align=e,this.__offsetX=t*this.scaleX,this.__offsetY=i*this.scaleY,null!=this.stage&&this.resize()},t.prototype.addEventTap=function(e){switch(typeof e){case"string":this.getChildByName(e).addEventListener(egret.TouchEvent.TOUCH_TAP,this.eventTapHandler,this);break;case"object":var t;for(t in e)this.getChildByName(e[t]).addEventListener(egret.TouchEvent.TOUCH_TAP,this.eventTapHandler,this);break;default:throw new Error(NodepErrorType.PARAM_TYPE_ERROR)}},t.prototype.tapCallback=function(e){},t.prototype.eventTapHandler=function(e){this.tapCallback(e.currentTarget.name)},t}(eui.Component);__reflect(GameWindow.prototype,"GameWindow");var StageLayer=function(e){function t(){var i=e.call(this)||this;return i._startX=-1e5,i._startY=-1e5,i._gridX_from=-1,i._gridX_to=-1,i._gridY_from=-1,i._gridY_to=-1,t.self=i,i}return __extends(t,e),t.prototype.addRole=function(e){this.addChild(e)},t.prototype.hitTestRole=function(e,t){return 0>e||0>t||e>GameConfig.WORD_W||t>GameConfig.WORD_H},t.prototype.trySynArea=function(e,t){},t}(egret.DisplayObjectContainer);__reflect(StageLayer.prototype,"StageLayer");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function r(e){t.call(n,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Globals=function(){function e(){this.net=new NetworkManager,this.killNum=0}return e.i=function(){return null==e._i&&(e._i=new e),e._i},e}();__reflect(Globals.prototype,"Globals");var AlignType=function(){function e(){}return e.TOP_LEFT="TOP_LEFT",e.TOP_CENTER="TOP_CENTER",e.TOP_RIGHT="TOP_RIGHT",e.CENTER="CENTER",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_CENTER="BOTTOM_CENTER",e.BOTTOM_RIGHT="BOTTOM_RIGHT",e.NONE="NONE",e}();__reflect(AlignType.prototype,"AlignType");var GameConfig=function(){function e(){}return e.rocker_bar_sensitivity=120,e.GRID_SIZE=512,e.WORD_W=2560,e.WORD_H=2560,e.pointOvertime=5e3,e.trapTime=5e3,e.game_time_t_my=10,e.Monster_NUM=20,e}();__reflect(GameConfig.prototype,"GameConfig");var LayerType=function(){function e(){}return e.LAYER_GROUND="LAYER_GROUND",e.LAYER_MENU="LAYER_MENU",e.LAYER_UI="LAYER_UI",e.LAYER_POP="LAYER_POP",e}();__reflect(LayerType.prototype,"LayerType");var NodepErrorType=function(){function e(){}return e.LAYER_NO_EXISTENT="LAYER_NO_EXISTENT",e.PARAM_TYPE_ERROR="PARAM_TYPE_ERROR",e.ERROR_CODE="ERROR_CODE",e}();__reflect(NodepErrorType.prototype,"NodepErrorType");var RoleType=function(){function e(){}return e.ROLE_PLAYER="ROLE_PLAYER",e.ROLE_NPC="ROLE_NPC",e.ROLE_ANIMAL="ROLE_ANIMAL",e.ROLE_WILD="ROLE_WILD",e.POLE_PLANT="POLE_PLANT",e.PLANT_TREE="TREE",e.PLANT_COLL="COLL",e.GROUND_ITEM="GROUND_ITEM",e.ORE="ORE",e.TRAP="TRAP",e}();__reflect(RoleType.prototype,"RoleType");var StandType=function(){function e(){}return e.SEA=1,e.LAND=2,e.LAKE=3,e}();__reflect(StandType.prototype,"StandType");var UpdateType=function(){function e(){}return e.USER_HISTORY_BACLL=10001,e.MAP_SELF_MOVE=20001,e.MAP_OPT_CHANGE=20002,e.MAIN_LOADING_SET=9990001,e}();__reflect(UpdateType.prototype,"UpdateType");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?n(r):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var WorWindowType=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.ROCKER_LEFT="ROCKER_LEFT",t.TOP_TOOLBAR="TOP_TOOLBAR",t.LOG_WINDOW="LOG_WINDOW",t.ROLE_WINDOW="ROLE_WINDOW",t.MAIN_LOADING="MAIN_LOADING",t}(WindowType);__reflect(WorWindowType.prototype,"WorWindowType");var GameLayer=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._wins=[],t._popCount=0,t}return __extends(t,e),t.prototype.addWindow=function(e){e.visible=!1,this.addChild(e),this._wins.push(e),e.pop&&this._popCount++,this.updateModel(),e.__inited&&e.reOpen(),e.__inited=!0},t.prototype.removeWindow=function(e){e.pop&&this._popCount--,this.updateModel(),this.removeChild(e),this._wins.splice(this._wins.indexOf(e),1)},t.prototype.updateModel=function(){!(this._popCount>0)||this._popShape&&this._popShape.parent?this._popCount<=0&&this._popShape&&this._popShape.parent&&(this.removeChild(this._popShape),this._popShape.graphics.clear(),this._popShape=null):(this._popShape||(this._popShape=new egret.Shape),this._popShape.graphics.clear(),this._popShape.graphics.beginFill(0,.7),this._popShape.graphics.drawRect(0,0,WinsManager.stageWidth,WinsManager.stageHeight),this._popShape.graphics.endFill,this._popShape.touchEnabled=!0,this.addChildAt(this._popShape,0))},t.prototype.resize=function(){var e;for(e in this._wins)this._wins[e].resize()},t}(egret.DisplayObjectContainer);__reflect(GameLayer.prototype,"GameLayer",["GameLayerInterface"]);var Monster=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(FocusRole);__reflect(Monster.prototype,"Monster");var PlayerRole=function(e){function t(){var i=e.call(this)||this;return t.self=i,i.type=RoleType.ROLE_PLAYER,i.speedX=8,i.speedY=4,i.path=new Array,i.roleMeshs=new Array,i}return __extends(t,e),t.prototype.renderUpdate=function(e){if(0!=RockBarContorller.offset){var t=this.x+RockBarContorller.multX*this.speedX,i=this.y+RockBarContorller.multY*this.speedY,n=StandType.LAND,r=!1;if(n==StandType.LAND&&(Tiled_Ground.getIns().groud.hitTestRole(t,i)?(t=this.x,i=this.y+RockBarContorller.multY*this.speedY,Tiled_Ground.getIns().groud.hitTestRole(t,i)?(t=this.x+RockBarContorller.multX*this.speedX,i=this.y,Tiled_Ground.getIns().groud.hitTestRole(t,i)||(r=!0)):r=!0):r=!0,r)){this.synWay(t,i),this.x=t,this.y=i;var o=new RolePathPoint(new egret.Point(t,i));this.path.push(o);var a=RoleMesh.check(this.path);null!=a&&this.roleMeshs.push(a),Globals.i().net.send({x:Math.round(t),y:Math.round(i)})}}},t}(FocusRole);__reflect(PlayerRole.prototype,"PlayerRole");var GroundLayer=function(e){function t(t,i){var n=e.call(this)||this;return n.mapW=t,n.mapH=i,n._mapBackground=new MapBackground,n._rolePath=new RolePath,n.addChild(n._mapBackground),n.addChild(n._rolePath),RenderManager.getIns().registRender(n._rolePath),n}return __extends(t,e),t.prototype.hitTestRole=function(e,t){return 0>e||0>t||e>GameConfig.WORD_W||t>GameConfig.WORD_H},t.prototype.synPositionTo=function(e,t){var i=this.stage.stageWidth/2,n=this.stage.stageHeight/2;i>e?this.x=0:this.mapW-e<i?this.x=-(this.mapW-this.stage.stageWidth):this.x=i-e,n>t?this.y=0:this.mapH-t<n?this.y=-(this.mapH-this.stage.stageHeight):this.y=n-t,this._mapBackground.render(e,t)},t.prototype.addRole=function(e){this.addChild(e)},t}(egret.DisplayObjectContainer);__reflect(GroundLayer.prototype,"GroundLayer");var MapBackground=function(e){function t(){var t=e.call(this)||this;t.bitmaps={};for(var i=0;i<GameConfig.WORD_W-1;i+=GameConfig.GRID_SIZE)for(var n=0;n<GameConfig.WORD_H-1;n+=GameConfig.GRID_SIZE)t.loadMapTile(i,n);return t}return __extends(t,e),t.prototype.loadMapTile=function(e,t){if(!(0>e||0>t)){var i=Math.floor(e/GameConfig.GRID_SIZE),n=Math.floor(t/GameConfig.GRID_SIZE),r=i+"_"+n;if(null==this.bitmaps[r]){var o=new egret.Bitmap;this.addChild(o),o.x=i*GameConfig.GRID_SIZE,o.y=n*GameConfig.GRID_SIZE,o.scaleX=2,o.scaleY=2,this.bitmaps[r]=o,RES.getResByUrl("resource/assets/map/1/"+r+".png",function(e){var t=e;o.texture=t},this,RES.ResourceItem.TYPE_IMAGE)}}},t.prototype.render=function(e,t){},t}(egret.DisplayObjectContainer);__reflect(MapBackground.prototype,"MapBackground");var RoleMesh=function(){function e(){this.points=new Array,this.x1=9999999,this.x2=-9999999,this.y1=9999999,this.y2=-9999999,this.rect=new egret.Rectangle,this.shape=new egret.Shape,WinsManager.getIns().gameStage().addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageTouch,this)}return e.prototype.onStageTouch=function(e){console.log(e.stageX,e.stageY),console.log("点中了吗 "+this.shape.hitTestPoint(e.stageX,e.stageY))},e.prototype.hitTest=function(e,t){if(e<this.x1&&e>this.x2||t<this.y1&&t>this.y2)return!1;var i=this.shape.hitTestPoint(e,t,!1);return i},e.prototype.addPoints=function(e){for(var t=0;t<e.length;t++){var i=e[t];this.x1>i.point.x&&(this.x1=i.point.x),this.x2<i.point.x&&(this.x2=i.point.x),this.y1>i.point.y&&(this.y1=i.point.y),this.y2<i.point.y&&(this.y2=i.point.y),i.isUsed=!0,this.time=egret.getTimer(),this.points.push(i)}},e.check=function(t){var i=5;if(!(t.length<5)){for(var n=0;n<t.length;n++)if(!t[n].isUsed)for(var r=n+i;r<t.length;r++)if(!t[r].isUsed&&egret.Point.distance(t[n].point,t[r].point)<6){var o=new e,a=t.slice(n,r);return o.addPoints(a),o}return null}},e.prototype.drawMesh=function(){this.shape.graphics.clear(),this.shape.graphics.beginFill(65280,1-(egret.getTimer()-this.time)/GameConfig.trapTime);var e=this.points[0].point;this.shape.graphics.moveTo(e.x,e.y);for(var t=1;t<this.points.length;t++)this.shape.graphics.lineTo(this.points[t].point.x,this.points[t].point.y);this.shape.graphics.endFill()},e.prototype.dispose=function(){null!=this.shape.parent&&this.shape.parent.removeChild(this.shape),WinsManager.getIns().gameStage().removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageTouch,this)},e}();__reflect(RoleMesh.prototype,"RoleMesh");var RolePath=function(e){function t(){var t=e.call(this)||this;return t._shape=new egret.Shape,t.addChild(t._shape),t}return __extends(t,e),t.prototype.renderUpdate=function(e){this.drawPath(PlayerRole.self.path),this.removeOvertimePoint(PlayerRole.self.path);for(var t=PlayerRole.self.roleMeshs.length-1;t>=0;t--){var i=PlayerRole.self.roleMeshs[t];if(!(egret.getTimer()-i.time<GameConfig.trapTime)){i.dispose(),PlayerRole.self.roleMeshs.splice(t,1);break}null==i.shape.parent&&this.addChild(i.shape),i.drawMesh()}},t.prototype.drawPath=function(e){if(e&&!(e.length<2)){this._shape.graphics.clear(),this._shape.graphics.lineStyle(2,16711680);var t=e[0].point;this._shape.graphics.moveTo(t.x,t.y);for(var i=1;i<e.length;i++)this._shape.graphics.lineTo(e[i].point.x,e[i].point.y);this._shape.graphics.endFill()}},t.prototype.removeOvertimePoint=function(e){e.length>0&&egret.getTimer()-e[0].time>GameConfig.pointOvertime&&e.shift()},t}(egret.DisplayObjectContainer);__reflect(RolePath.prototype,"RolePath",["IRender"]);var RolePathPoint=function(){function e(e){this.isUsed=!1,this.time=egret.getTimer(),this.point=e}return e}();__reflect(RolePathPoint.prototype,"RolePathPoint");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Tiled_Ground=function(e){function t(){var t=e.call(this)||this;return t.scaleX=WinsManager.scaleX,t.scaleY=WinsManager.scaleY,t}return __extends(t,e),t.getIns=function(){return null==t._ins&&(t._ins=new t),t._ins},t.prototype.renderUpdate=function(e){this.groud.synPositionTo(this._focus.x,this._focus.y)},t.prototype.setFocus=function(e){null!=this._focus&&(this._focus.__isFocus=!1),this._focus=this.roleMap[e],this._focus.__isFocus=!0},t.prototype.addFocusRole=function(e){this.roleMap[e.id]=e,this.groud.addRole(e),e.addToWorld()},t.prototype.initWorld=function(){this.roleMap={},this.groud=new GroundLayer(GameConfig.WORD_W,GameConfig.WORD_H),this.addChild(this.groud),this.createSelf(),this.monsterManager=new MonsterManager,RenderManager.getIns().registRender(this),RenderManager.getIns().registRender(this.monsterManager)},t.prototype.createSelf=function(){this._self=new PlayerRole,this._self.x=1e3,this._self.y=1e3,this.addFocusRole(this._self),this.setFocus(this._self.id)},t}(egret.DisplayObjectContainer);__reflect(Tiled_Ground.prototype,"Tiled_Ground",["IRender"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.stage.$scaleMode=egret.StageScaleMode.FIXED_WIDTH,egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return t=i.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return i.sent(),this.stage.removeChild(e),[3,5];case 4:return t=i.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){this.stage.scaleMode=egret.StageScaleMode.NO_SCALE,LogTrace.log("application loadcompleted..."),WinsManager.getIns().initGame(this),RenderManager.getIns().startRender(this.stage),WinsManager.getIns().addLayer(LayerType.LAYER_GROUND,new GameLayer),WinsManager.getIns().addLayer(LayerType.LAYER_MENU,new GameLayer),WinsManager.getIns().addLayer(LayerType.LAYER_UI,new GameLayer),WinsManager.getIns().addLayer(LayerType.LAYER_POP,new GameLayer),this.startGame()},t.prototype.startGame=function(){Globals.i(),DelayCall.call(200,this.delayStart,this)},t.prototype.delayStart=function(){GameManager.getIns().startNewGame()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var AlertWindow=function(e){function t(){var t=e.call(this)||this;return t.layerType=LayerType.LAYER_POP,t.typeName=WindowType.ALERT_WIN,t.pop=!0,t.align(AlignType.CENTER,0,0),t}return __extends(t,e),t.alertShow=function(e,i,n,r){void 0===r&&(r=null),t._message=e,t._callBack=i,t._thisObject=n,t._labels=r,WinsManager.getIns().openWindow(t)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.getChildByName("okBtn").addEventListener(egret.TouchEvent.TOUCH_TAP,this.handler,this),this.getChildByName("cancelBtn").addEventListener(egret.TouchEvent.TOUCH_TAP,this.handler,this),this.reOpen()},t.prototype.handler=function(e){null!=t._callBack&&t._callBack.apply(t._thisObject,["okBtn"==e.currentTarget.name]),WinsManager.getIns().closeWin(this)},t.prototype.reOpen=function(){e.prototype.reOpen.call(this),this.getChildByName("infoTxt").text=t._message},t}(GameWindow);__reflect(AlertWindow.prototype,"AlertWindow",["eui.UIComponent","egret.DisplayObject"]);var GameMainLoaderWindow=function(e){function t(){var t=e.call(this)||this;return t.layerType=LayerType.LAYER_POP,t.typeName=WorWindowType.MAIN_LOADING,t.align(AlignType.TOP_LEFT),t}return __extends(t,e),t.prototype.childrenCreated=function(){this._bgShape=new egret.Shape,this._bgShape.graphics.beginFill(0,1),this._bgShape.graphics.drawRect(0,0,1,1),this._bgShape.graphics.endFill(),this.addChildAt(this._bgShape,0),this._infoLabel=this.getChildByName("message"),this._infoLabel.text="",e.prototype.childrenCreated.call(this)},t.prototype.resize=function(){e.prototype.resize.call(this),null!=this._bgShape&&(this._bgShape.scaleX=WinsManager.stageWidth,this._bgShape.scaleY=WinsManager.stageHeight,this._infoLabel.x=(WinsManager.stageWidth-this._infoLabel.width)/2,this._infoLabel.y=(WinsManager.stageHeight-this._infoLabel.height)/2)},t.prototype.update=function(e,t){switch(e){case UpdateType.MAIN_LOADING_SET:this._infoLabel.text=t}},t}(GameWindow);__reflect(GameMainLoaderWindow.prototype,"GameMainLoaderWindow",["eui.UIComponent","egret.DisplayObject"]);var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var HBox=function(){function e(){}return e}();__reflect(HBox.prototype,"HBox");var LogWindow=function(e){function t(){var t=e.call(this)||this;return t.layerType=LayerType.LAYER_UI,t.typeName=WorWindowType.LOG_WINDOW,t.pop=!0,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(GameWindow);__reflect(LogWindow.prototype,"LogWindow",["eui.UIComponent","egret.DisplayObject"]);var ProgressBar=function(){function e(e){this._maxWidth=0,this._maxHeight=0,this._cur=-1,this._total=-1,this._maskShape=new egret.Shape,e.mask=this._maskShape,this._maskShape.x=e.x,this._maskShape.y=e.y,e.parent.addChild(this._maskShape),this._maxWidth=e.width,this._maxHeight=e.height}return e.prototype.setProgress=function(e,t){this._maskShape.graphics.clear(),this._maskShape.graphics.beginFill(0,1),this._maskShape.graphics.drawRect(0,0,Math.round(this._maxWidth*e/t),this._maxHeight),this._maskShape.graphics.endFill()},e}();__reflect(ProgressBar.prototype,"ProgressBar");var RockBarContorller=function(){function e(e,t,i){this._movePoint=new egret.Point,this._px=t,this._py=i,this._barBtn=e,this._restPoint=new egret.Point(this._barBtn.x,this._barBtn.y),this._barBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHandler,this)}return e.prototype.touchBeginHandler=function(e){null==this._startPoint&&(this._startPoint=new egret.Point),this._startPoint.x=e.stageX,this._startPoint.y=e.stageY,this._barBtn.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHandler,this),this._barBtn.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.cancelHandler,this),this._barBtn.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.cancelHandler,this)},e.prototype.touchMoveHandler=function(t){this._movePoint.x=t.stageX,this._movePoint.y=t.stageY;var i=egret.Point.distance(this._startPoint,this._movePoint);if(i<=GameConfig.rocker_bar_sensitivity)this._barBtn.x=this._restPoint.x+this._movePoint.x-this._startPoint.x,this._barBtn.y=this._restPoint.y+this._movePoint.y-this._startPoint.y;else{var n=egret.Point.interpolate(this._movePoint,this._startPoint,GameConfig.rocker_bar_sensitivity/i);this._barBtn.x=n.x-this._px,this._barBtn.y=n.y-this._py}e.multX=(this._movePoint.x-this._startPoint.x)/i,e.multY=(this._movePoint.y-this._startPoint.y)/i,e.offset=i/GameConfig.rocker_bar_sensitivity},e.prototype.cancelHandler=function(t){this._barBtn.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHandler,this),this._barBtn.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.cancelHandler,this),this._barBtn.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.cancelHandler,this),egret.Tween.removeTweens(this._barBtn),egret.Tween.get(this._barBtn).to({x:this._restPoint.x,y:this._restPoint.y},50,egret.Ease.backOut),e.multX=0,e.multY=0,e.offset=0},e.multX=0,e.multY=0,e.offset=0,e}();__reflect(RockBarContorller.prototype,"RockBarContorller");var RockerBar=function(e){function t(){var t=e.call(this)||this;return t.layerType=LayerType.LAYER_UI,t.typeName=WorWindowType.ROCKER_LEFT,t.align(AlignType.BOTTOM_LEFT,150,-150),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._contorller=new RockBarContorller(this.getChildByName("barBtn"),this.x,this.y),this.drawC()},t.prototype.drawC=function(){this._bgShape||(this._bgShape=new egret.Shape,this.addChildAt(this._bgShape,0),this._bgShape.touchEnabled=!1),this._bgShape.graphics.clear(),this._bgShape.graphics.beginFill(16777215,.5),this._bgShape.graphics.drawCircle(this.getChildByName("barBtn").anchorOffsetX,this.getChildByName("barBtn").anchorOffsetY,GameConfig.rocker_bar_sensitivity),this._bgShape.graphics.endFill()},t}(GameWindow);__reflect(RockerBar.prototype,"RockerBar",["eui.UIComponent","egret.DisplayObject"]);var TopToolBar=function(e){function t(){var t=e.call(this)||this;return t._btnNames=["logBtn"],t.typeName=WorWindowType.TOP_TOOLBAR,t.layerType=LayerType.LAYER_MENU,t.align(AlignType.TOP_RIGHT,0,20),t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEventTap(this._btnNames)},t.prototype.tapCallback=function(e){switch(e){case"logBtn":GameManager.getIns().openGameUI(LogWindow);break;default:LogTrace.log("未处理的子对象")}},t}(GameWindow);__reflect(TopToolBar.prototype,"TopToolBar",["eui.UIComponent","egret.DisplayObject"]);var VBox=function(){function e(){}return e}();__reflect(VBox.prototype,"VBox");var GameManager=function(){function e(){this.isNewGame=!1}return e.getIns=function(){return null==e._ins&&(e._ins=new e),e._ins},e.prototype.startNewGame=function(){WinsManager.getIns().openWindow(GameMainLoaderWindow),DelayCall.call(100,this.buildEnter,this)},e.prototype.buildEnter=function(){this.enterGame()},e.prototype.enterGame=function(){WinsManager.getIns().gameStage().addChildAt(Tiled_Ground.getIns(),0),Tiled_Ground.getIns().initWorld(),WinsManager.getIns().openWindow(RockerBar),WinsManager.getIns().openWindow(TopToolBar),WinsManager.getIns().gameStage().addEventListener(egret.Event.DEACTIVATE,this.deactivateHandler,this),WinsManager.getIns().gameStage().addEventListener(egret.Event.ACTIVATE,this.activateHandler,this),WinsManager.getIns().closeWin(GameMainLoaderWindow)},e.prototype.deactivateHandler=function(){LogTrace.log("暂停游戏")},e.prototype.activateHandler=function(){LogTrace.log("继续游戏->继续")},e.prototype.openGameUI=function(e){WinsManager.getIns().openWindow(e)},e.prototype.setMainLoadingInfo=function(e){WinsManager.getIns().updateWin(UpdateType.MAIN_LOADING_SET,[WorWindowType.MAIN_LOADING],e)},e}();__reflect(GameManager.prototype,"GameManager");var LogTrace=function(){function e(){}return e.log=function(e){console.log(e)},e}();__reflect(LogTrace.prototype,"LogTrace");var MonsterManager=function(){function e(){this.monsters=new Array,this.createMonster()}return e.prototype.renderUpdate=function(e){this.monsters.forEach(function(e){if(!e.isDead&&PlayerRole.self.roleMeshs.length>0)for(var t=0;t<PlayerRole.self.roleMeshs.length;t++){var i=PlayerRole.self.roleMeshs[t],n=e.localToGlobal(),r=i.hitTest(n.x,n.y);e.setDead(r)}})},e.prototype.createMonster=function(){for(var e=0;e<GameConfig.Monster_NUM;e++){var t=new Monster;this.monsters.push(t),t.x=Math.abs(Math.random()*GameConfig.WORD_W),t.y=Math.abs(Math.random()*GameConfig.WORD_H),Tiled_Ground.getIns().addFocusRole(t)}},e}();__reflect(MonsterManager.prototype,"MonsterManager",["IRender"]);var RenderManager=function(){function e(){this._lastTime=0,this._renderList=new Array}return e.getIns=function(){return this._ins||(this._ins=new e),this._ins},e.prototype.startRender=function(e){this._stage=e,this._lastTime=egret.getTimer(),this._stage.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.enterFrameHandler=function(e){var t,i=egret.getTimer(),n=i-this._lastTime;this._lastTime=i;for(t in this._renderList)this._renderList[t].renderUpdate(n)},e.prototype.registRender=function(e){this._renderList.push(e)},e.prototype.unregistRender=function(e){var t=this._renderList.indexOf(e);t>=0&&this._renderList.splice(t,1)},e.frameRate=30,e}();__reflect(RenderManager.prototype,"RenderManager");var WinsManager=function(){function e(){if(null!=e._ins)throw new Error("单例");this._layerMap={},this._windowMap={},LogTrace.log("create WinsManager!")}return e.prototype.initScale=function(){LogTrace.log(e.stageWidth+"_"+e.stageHeight),e.scaleX=e.stageWidth/1254,e.scaleY=e.scaleX},e.getIns=function(){return e._ins||(e._ins=new e),e._ins},e.prototype.initGame=function(t){this._baseUi=t,this._baseUi.stage.addEventListener(egret.Event.RESIZE,this.stageResizeHandler,this),e.stageWidth=this._baseUi.stage.stageWidth,e.stageHeight=this._baseUi.stage.stageHeight,this.initScale()},e.prototype.addLayer=function(e,t){this._layerMap[e]=t,this._baseUi.addChild(t),LogTrace.log("add layer:"+e)},e.prototype.switchWin=function(e){null==this._windowMap[e]&&(this._windowMap[e]=new e);var t=this._windowMap[e];null==t.stage?this.openWindow(e):this.closeWin(e)},e.prototype.openWindow=function(e){null==this._windowMap[e]&&(this._windowMap[e]=new e);var t=this._windowMap[e];if(!t.stage){if(!this._layerMap[t.layerType])throw new Error(NodepErrorType.LAYER_NO_EXISTENT);this._layerMap[t.layerType].addWindow(t),LogTrace.log("openWindow->"+t.typeName)}},e.prototype.openWindowToLayer=function(e,t){this._windowMap[e]||(this._windowMap[e]=new e);var i=this._windowMap[e];if(!i.stage){if(!this._layerMap[t])throw new Error(NodepErrorType.LAYER_NO_EXISTENT);this._layerMap[t].addWindow(i),LogTrace.log("openWindow->"+i.typeName)}},e.prototype.closeWin=function(e){if(e){var t=null;switch(typeof e){case"object":t=e;break;case"string":break;case"function":t=this._windowMap[e]}t&&t.parent&&t.beforeClose()&&t.parent.removeWindow(t)}},e.prototype.updateWin=function(e,t,i){void 0===i&&(i=null);for(var n in this._windowMap){var r=this._windowMap[n];t.indexOf(r.typeName)>=0&&null!=r.stage&&r.update(e,i)}},e.prototype.globalUpdate=function(e,t){for(var i in this._windowMap){var n=this._windowMap[i];null!=n.stage&&n.update(e,t)}},e.prototype.stageResizeHandler=function(t){e.stageWidth=this._baseUi.stage.stageWidth,e.stageHeight=this._baseUi.stage.stageHeight,this.initScale(),LogTrace.log("stageReszie!");for(var i in this._layerMap){var n=this._layerMap[i];n.resize()}},e.prototype.gcWindow=function(e){},e.prototype.gcWindowAll=function(){},e.prototype.showFloatText=function(t){function i(){n.parent.removeChild(n)}var n=new egret.TextField;
n.text=t,n.width=500,n.size=40,n.textColor=16724736,n.x=e.stageWidth/2-n.width/2,n.y=e.stageHeight/2,this.gameStage().addChild(n),egret.Tween.get(n).to({y:n.y-200},1500).call(i,this)},e.prototype.gameStage=function(){return null!=this._baseUi?this._baseUi.stage:null},e.stageWidth=0,e.stageHeight=0,e.scaleX=1,e.scaleY=1,e}();__reflect(WinsManager.prototype,"WinsManager");var NetworkManager=function(){function e(){this._len=-1,this.bytes=new egret.ByteArray,this.socket=new egret.WebSocket,this.socket.connectByUrl("ws://localhost:8080/websocket"),this.socket.addEventListener(egret.Event.CONNECT,function(e){console.log(e)},this),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this)}return e.prototype.onReceiveMessage=function(e){var t,i=this.socket.readUTF();try{t=JSON.parse(i),console.log("收到消息 "+t)}catch(n){console.log("收到消息 "+i)}},e.prototype.send=function(e){this.socket.writeUTF(JSON.stringify(e))},e}();__reflect(NetworkManager.prototype,"NetworkManager");var DelayCall=function(){function e(e,t,i){void 0===i&&(i=null),this.delayTime=0,this.repeatCount=0,this._costTime=0,this._callBack=e,this._thisObject=t,this._args=i}return e.call=function(t,i,n,r,o){void 0===r&&(r=null),void 0===o&&(o=1);var a=new e(i,n,r);return a.delayTime=t,a.repeatCount=o,RenderManager.getIns().registRender(a),a},e.prototype.renderUpdate=function(e){this._costTime+=e,this._costTime>=this.delayTime&&(this.repeatCount>0?(this.repeatCount-=1,this.repeatCount<=0&&(RenderManager.getIns().unregistRender(this),null!=this._callBack&&this._callBack.apply(this._thisObject,this._args)),this._callBack=null,this._thisObject=null,this._args=null):(this._costTime=this._costTime-this.delayTime,null!=this._callBack&&this._callBack.apply(this._thisObject,this._args)))},e}();__reflect(DelayCall.prototype,"DelayCall",["IRender"]);var ObjectUtil=function(){function e(){}return e.copyTo=function(e,t){var i;for(i in e)t[i]=e[i]},e}();__reflect(ObjectUtil.prototype,"ObjectUtil");var TimeUtil=function(){function e(){}return e.getTimeStrByHM=function(e,t){var i="";return i+=e>=10?e+":":"0"+e+":",i+=t>=10?t:"0"+t},e}();__reflect(TimeUtil.prototype,"TimeUtil");